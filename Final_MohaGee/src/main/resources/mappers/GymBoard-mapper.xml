<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC
"-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="GymBoard-mapper">

	<select id="selectList" resultType="GymBoard">
      SELECT B.*, a.bfilename titleFilename, a.bFileType FROM BOARD B
      LEFT JOIN B_ATTACHMENT A ON(B.BNO = A.BNO AND A.BFILELEVEL = 0 AND BFILESTATUS = 'N') 
      WHERE BSTATUS = 'N' order by BDATE DESC
	</select>
	
	<insert id="insertGymBoard" parameterType="GymBoard">
      INSERT INTO BOARD 
      VALUES(SEQ_BNO.NEXTVAL, 
         #{userNo},
         #{bTitle},
         #{bTag},
         #{bContent},
         #{cNo},
         #{bUrl},
         #{bCategory},
         #{bCount},
         DEFAULT,
         DEFAULT)
	</insert>
	
	<insert id="insertGymAttachment" parameterType="GymAttachment">
		<selectKey keyProperty="bNo" resultType="int" order="BEFORE">
         SELECT SEQ_BNO.CURRVAL FROM DUAL
		</selectKey>
      INSERT INTO B_ATTACHMENT
      VALUES (SEQ_BFILENO.NEXTVAL,
      	    #{bNo}, 
            #{bFileName}, 
            #{bFilePath},
            DEFAULT, DEFAULT, DEFAULT,
            #{bFileType})
	</insert>
	
	<select id="selectGymBoard" parameterType="_int" resultType="GymBoard">
      SELECT * FROM BOARD WHERE BNO = #{bNo}
	</select>
	
	<select id="selectGymAttachment" parameterType="int" resultType="GymAttachment">
      SELECT * FROM B_ATTACHMENT WHERE BNO = #{bNo} AND BFILESTATUS = 'N'
	</select>
	
	<update id="updateGymBoard" parameterType="GymBoard">
      UPDATE BOARD
      SET BTITLE = #{bTitle},
              BCONTENT = #{bContent},
              BTAG = #{bTag},
              BURL = #{bUrl},
              BCATEGORY = #{bCategory}
      WHERE BNO = #{bNo}
	</update>
	
	<insert id="updateGymAttachment" parameterType="GymAttachment">
      INSERT INTO B_ATTACHMENT
      VALUES (SEQ_BFILENO.NEXTVAL, #{bNo}, 
            #{bFileName}, 
	   #{bFilePath},
            DEFAULT, DEFAULT, DEFAULT, #{bFileType})
	</insert>
	
	<update id="deleteGymBoard" parameterType="int">
      UPDATE BOARD SET BSTATUS= 'Y' WHERE BNO = #{bNo}
	</update>
	
	<update id="deleteGymAttachment" parameterType="int">
      UPDATE B_ATTACHMENT
      SET BFILESTATUS = 'Y' WHERE BNO = #{bNo}
	</update>
</mapper>










